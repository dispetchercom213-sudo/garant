<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScaleBridge - –ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>‚öñÔ∏è ScaleBridge</h1>
      <p class="subtitle">–ú–æ—Å—Ç –º–µ–∂–¥—É –≤–µ—Å–∞–º–∏ –∏ BetonAPP</p>
    </header>

    <div class="status-bar">
      <div class="status-item">
        <span class="status-label">–°—Ç–∞—Ç—É—Å –≤–µ—Å–æ–≤:</span>
        <span id="scaleStatus" class="status-value disconnected">–û—Ç–∫–ª—é—á–µ–Ω–æ</span>
      </div>
      <div class="status-item">
        <span class="status-label">–¢–µ–∫—É—â–∏–π –≤–µ—Å:</span>
        <span id="currentWeight" class="status-value">0 –∫–≥</span>
      </div>
      <div class="status-item ip-highlight" id="ipContainer" title="–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å">
        <span class="status-label">üåê IP –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</span>
        <span id="localIp" class="status-value">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-button active" data-tab="scale">–í–µ—Å—ã</button>
      <button class="tab-button" data-tab="camera">–ö–∞–º–µ—Ä–∞</button>
      <button class="tab-button" data-tab="backend">Backend</button>
      <button class="tab-button" data-tab="general">–û–±—â–∏–µ</button>
    </div>

    <div class="tab-content">
      <!-- –í–∫–ª–∞–¥–∫–∞: –í–µ—Å—ã -->
      <div id="scale-tab" class="tab-panel active">
        <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ—Å–æ–≤</h2>
        
        <div class="form-group">
          <label for="comPort">COM-–ø–æ—Ä—Ç:</label>
          <div class="input-with-button">
            <select id="comPort"></select>
            <button id="refreshPorts" class="btn btn-secondary">–û–±–Ω–æ–≤–∏—Ç—å</button>
          </div>
        </div>

        <div class="form-group">
          <label for="baudRate">–°–∫–æ—Ä–æ—Å—Ç—å (baud rate):</label>
          <select id="baudRate">
            <option value="2400">2400</option>
            <option value="4800">4800</option>
            <option value="9600" selected>9600</option>
            <option value="19200">19200</option>
            <option value="38400">38400</option>
            <option value="57600">57600</option>
            <option value="115200">115200</option>
          </select>
        </div>

        <div class="form-group">
          <label for="dataBits">–ë–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö:</label>
          <select id="dataBits">
            <option value="7">7</option>
            <option value="8" selected>8</option>
          </select>
        </div>

        <div class="form-group">
          <label for="parity">–ß—ë—Ç–Ω–æ—Å—Ç—å:</label>
          <select id="parity">
            <option value="none" selected>None</option>
            <option value="even">Even</option>
            <option value="odd">Odd</option>
          </select>
        </div>

        <div class="form-group">
          <label for="stopBits">–°—Ç–æ–ø-–±–∏—Ç—ã:</label>
          <select id="stopBits">
            <option value="1" selected>1</option>
            <option value="2">2</option>
          </select>
        </div>

        <div class="button-group">
          <button id="reconnectScale" class="btn btn-primary">–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–µ—Å—ã</button>
        </div>
      </div>

      <!-- –í–∫–ª–∞–¥–∫–∞: –ö–∞–º–µ—Ä–∞ -->
      <div id="camera-tab" class="tab-panel">
        <h2>üì∑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–º–µ—Ä—ã</h2>

        <div class="form-group">
          <label for="cameraType">–¢–∏–ø –∫–∞–º–µ—Ä—ã:</label>
          <select id="cameraType">
            <option value="usb" selected>USB –∫–∞–º–µ—Ä–∞</option>
            <option value="rtsp">RTSP –ø–æ—Ç–æ–∫</option>
          </select>
        </div>

        <div class="form-group" id="usbCameraGroup">
          <label>üìπ USB –∫–∞–º–µ—Ä—ã (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ):</label>
          <div style="border: 1px solid #e9ecef; border-radius: 6px; padding: 10px; background: #f8f9fa;">
            <label style="display: block; margin-bottom: 8px;">
              <input type="checkbox" id="camera0" value="0" style="margin-right: 8px;">
              üì∑ –ö–∞–º–µ—Ä–∞ 0 (–û—Å–Ω–æ–≤–Ω–∞—è / –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è)
            </label>
            <label style="display: block; margin-bottom: 8px;">
              <input type="checkbox" id="camera1" value="1" style="margin-right: 8px;">
              üì∑ –ö–∞–º–µ—Ä–∞ 1 (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è USB)
            </label>
            <label style="display: block; margin-bottom: 8px;">
              <input type="checkbox" id="camera2" value="2" style="margin-right: 8px;">
              üì∑ –ö–∞–º–µ—Ä–∞ 2
            </label>
            <label style="display: block; margin-bottom: 8px;">
              <input type="checkbox" id="camera3" value="3" style="margin-right: 8px;">
              üì∑ –ö–∞–º–µ—Ä–∞ 3
            </label>
            <label style="display: block;">
              <input type="checkbox" id="camera4" value="4" style="margin-right: 8px;">
              üì∑ –ö–∞–º–µ—Ä–∞ 4
            </label>
          </div>
          <small>üí° –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å 2-3 –∫–∞–º–µ—Ä—ã –¥–ª—è —Å—ä–µ–º–∫–∏ —Å —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∫—É—Ä—Å–æ–≤. 
          –û–±—ã—á–Ω–æ 0 - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∫–∞–º–µ—Ä–∞ –Ω–æ—É—Ç–±—É–∫–∞, 1+ - –≤–Ω–µ—à–Ω–∏–µ USB –∫–∞–º–µ—Ä—ã.</small>
        </div>

        <div class="form-group" id="rtspUrlGroup" style="display: none;">
          <label>üåê RTSP –∫–∞–º–µ—Ä—ã (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ):</label>
          
          <div id="rtspCamerasList" style="margin-top: 10px;">
            <!-- –ö–∞–º–µ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
          
          <button type="button" class="btn btn-success btn-small" onclick="addRtspCamera()" style="margin-top: 10px;">
            ‚ûï –î–æ–±–∞–≤–∏—Ç—å RTSP –∫–∞–º–µ—Ä—É
          </button>
          
          <div style="margin-top: 15px;">
            <label style="font-size: 0.9em; color: #6c757d;">–®–∞–±–ª–æ–Ω—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π:</label>
            <div class="button-group" style="display: flex; gap: 5px; flex-wrap: wrap; margin-top: 5px;">
              <button type="button" class="btn btn-secondary btn-small" onclick="fillRtspTemplate('hikvision')">üìπ Hikvision</button>
              <button type="button" class="btn btn-secondary btn-small" onclick="fillRtspTemplate('dahua')">üìπ Dahua</button>
              <button type="button" class="btn btn-secondary btn-small" onclick="fillRtspTemplate('tplink')">üìπ TP-Link</button>
              <button type="button" class="btn btn-secondary btn-small" onclick="fillRtspTemplate('axis')">üìπ Axis</button>
              <button type="button" class="btn btn-secondary btn-small" onclick="fillRtspTemplate('generic')">üìπ Generic</button>
            </div>
          </div>
          
          <small style="display: block; margin-top: 10px;">üí° –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–ª–µ.</small>
        </div>

        <div class="form-group">
          <label for="photosRetentionDays">–•—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ç–æ (–¥–Ω–µ–π):</label>
          <input type="number" id="photosRetentionDays" value="30" min="1" max="365">
        </div>

        <div class="button-group">
          <button id="testCamera" class="btn btn-primary">–¢–µ—Å—Ç–æ–≤—ã–π —Å–Ω–∏–º–æ–∫</button>
        </div>

        <div id="cameraTestResult" class="test-result"></div>
      </div>

      <!-- –í–∫–ª–∞–¥–∫–∞: Backend -->
      <div id="backend-tab" class="tab-panel">
        <h2>üîó –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Backend</h2>

        <div class="form-group">
          <label for="backendUrl">URL Backend:</label>
          <input type="text" id="backendUrl" placeholder="http://localhost:4000">
        </div>

        <div class="form-group">
          <label for="apiKey">API –∫–ª—é—á:</label>
          <div class="input-with-button">
            <input type="text" id="apiKey" readonly>
            <button id="copyApiKey" class="btn btn-secondary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
          <small>–≠—Ç–æ—Ç –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ backend</small>
        </div>

        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="backendSync" checked>
            <span>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ backend</span>
          </label>
        </div>

        <div class="button-group">
          <button id="testConnection" class="btn btn-primary">–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</button>
        </div>

        <div id="connectionTestResult" class="test-result"></div>

        <div class="info-box">
          <h3>‚ÑπÔ∏è –õ–æ–∫–∞–ª—å–Ω—ã–π API —Å–µ—Ä–≤–µ—Ä</h3>
          <p>Backend –∑–∞–ø—É—â–µ–Ω –Ω–∞: <strong>http://localhost:5055</strong></p>
          <p>–î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints:</p>
          <ul>
            <li><code>GET /api/weight</code> - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –≤–µ—Å</li>
            <li><code>POST /api/capture</code> - —Å–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ</li>
            <li><code>POST /api/command</code> - –∫–æ–º–∞–Ω–¥–∞ (brutto/tara)</li>
            <li><code>GET /api/health</code> - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞</li>
          </ul>
        </div>
      </div>

      <!-- –í–∫–ª–∞–¥–∫–∞: –û–±—â–∏–µ -->
      <div id="general-tab" class="tab-panel">
        <h2>‚öôÔ∏è –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

        <div class="form-group checkbox-group">
          <label>
            <input type="checkbox" id="autoStart" checked>
            <span>–ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Windows</span>
          </label>
        </div>

        <div class="form-group">
          <label for="language">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</label>
          <select id="language">
            <option value="ru" selected>–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
          </select>
        </div>

        <div class="info-box">
          <h3>üìù –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
          <p><strong>–í–µ—Ä—Å–∏—è:</strong> 1.0.0</p>
          <p><strong>–õ–æ–≥–∏:</strong> logs/scale_log.txt</p>
          <p><strong>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</strong> photos/</p>
        </div>

        <div class="info-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px;">
          <h3 style="color: white; margin-bottom: 15px;">üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
          <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin-bottom: 10px;">
            <p style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">IP –∞–¥—Ä–µ—Å ScaleBridge:</strong></p>
            <p style="font-size: 1.5em; font-weight: 600; margin: 5px 0;"><span id="appIp">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
          </div>
          <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px;">
            <p style="margin-bottom: 8px;"><strong style="color: rgba(255,255,255,0.9);">URL –¥–ª—è Backend:</strong></p>
            <p style="font-size: 1.2em; font-weight: 500; margin: 5px 0; word-break: break-all;"><span id="apiUrl">http://localhost:5055</span></p>
          </div>
          <p style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
            ‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç IP –∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Backend –∫ ScaleBridge
          </p>
        </div>
      </div>
    </div>

    <footer>
      <button id="saveConfig" class="btn btn-success btn-large">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
      <div id="notification" class="notification"></div>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>

